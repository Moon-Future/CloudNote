## äº‹ä»¶æµ

> äº‹ä»¶å‘ç”Ÿæ—¶ä¼šåœ¨å…ƒç´ èŠ‚ç‚¹ä¹‹é—´æŒ‰ç…§**ç‰¹å®šçš„é¡ºåº**ä¼ æ’­ï¼Œè¿™ä¸ªä¼ æ’­è¿‡ç¨‹å³ **DOMäº‹ä»¶æµ**ã€‚

äº‹ä»¶æµåˆç§°äº‹ä»¶ä¼ æ’­ï¼ŒDOM2 çº§äº‹ä»¶è§„å®šçš„äº‹ä»¶æµåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š

- **æ•è·é˜¶æ®µ**ï¼ˆcapture phaseï¼‰ï¼šäº‹ä»¶ä» Document èŠ‚ç‚¹è‡ªä¸Šè€Œä¸‹å‘ç›®æ ‡èŠ‚ç‚¹ä¼ æ’­çš„é˜¶æ®µ
- **ç›®æ ‡é˜¶æ®µ**ï¼ˆtarget phaseï¼‰ï¼šçœŸæ­£çš„ç›®æ ‡èŠ‚ç‚¹æ­£åœ¨å¤„ç†äº‹ä»¶çš„é˜¶æ®µ
- **å†’æ³¡é˜¶æ®µ**ï¼ˆbubbling phaseï¼‰ï¼šäº‹ä»¶ä»ç›®æ ‡èŠ‚ç‚¹è‡ªä¸‹è€Œä¸Šå‘ Document èŠ‚ç‚¹ä¼ æ’­çš„é˜¶æ®µ

é¦–å…ˆå‘ç”Ÿçš„æ˜¯äº‹ä»¶æ•è·ï¼Œä¸ºæˆªè·äº‹ä»¶æä¾›äº†æœºä¼šã€‚ç„¶åæ˜¯å®é™…çš„ç›®æ ‡æ¥å—åˆ°äº‹ä»¶ï¼Œæœ€åä¸€ä¸ªé˜¶æ®µæ˜¯å†’æ³¡é˜¶æ®µï¼Œå¯ä»¥åœ¨è¿™ä¸ªé˜¶æ®µå¯¹äº‹ä»¶åšå‡ºå“åº”ã€‚

![DOMäº‹ä»¶æµ](https://cloud-images-1255423800.cos.ap-guangzhou.myqcloud.com/js_DOM%E4%BA%8B%E4%BB%B6%E6%B5%81-1.png)

## addEventListener

```js
target.addEventListener(type, listener, options); // { capture: Boolean }
target.addEventListener(type, listener, useCapture);
```

- typeï¼šè¡¨ç¤ºç›‘å¬äº‹ä»¶ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¦‚ click
- listenerï¼šäº‹ä»¶å¤„ç†ç¨‹åºå‡½æ•°
- useCaptureï¼šå¦‚æœæ˜¯ true åˆ™è¡¨ç¤ºåœ¨æ•è·é˜¶æ®µè°ƒç”¨ï¼Œä¸º false è¡¨ç¤ºåœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨

## è·¨æµè§ˆå™¨çš„äº‹ä»¶å¤„ç†ç¨‹åº

```js
var EventUtil = {
    // ç»‘å®šäº‹ä»¶
    addHandler: function(element, type, handler) {
        if (element.addEventListener) {
            // DOM2çº§äº‹ä»¶
            element.addEventListenter(type, handler, false)
        } else if (element.attachEvent) {
            // IE
            element.attachEvent('on' + type, handler)
        } else {
            // DOM0çº§äº‹ä»¶
            element['on' + type] = handler
        }
    },
    // ç§»é™¤äº‹ä»¶
    removeHandler: function(element, type, handler) {
        if (element.removeEventListener) {
            element.removeEventListener(type, handler, false)
        } else if (element.detachEvent) {
            element.detachEvent('on' + type, handler)
        } else {
            element['on' + type] = null
        }
    }
}
```

## äº‹ä»¶å§”æ‰˜çš„ä¼˜ç¼ºç‚¹

**äº‹ä»¶å§”æ‰˜åŸç†**ï¼šäº‹ä»¶å†’æ³¡æœºåˆ¶

ä¼˜ç‚¹ï¼š

1. å¯ä»¥å¤§é‡èŠ‚çœå†…å­˜å ç”¨ï¼Œå‡å°‘äº‹ä»¶æ³¨å†Œã€‚å¦‚ï¼š

   - åœ¨tableä¸Šä»£ç†æ‰€æœ‰tdçš„clickäº‹ä»¶ã€‚

   - åœ¨ulä¸Šä»£ç†æ‰€æœ‰liçš„clickäº‹ä»¶ã€‚

2. å½“æ–°å¢å­ DOM å¯¹è±¡æ—¶ï¼Œæ— éœ€å†å¯¹å…¶è¿›è¡Œäº‹ä»¶ç»‘å®šï¼Œå¯¹äºåŠ¨æ€å†…å®¹éƒ¨åˆ†å°¤ä¸ºåˆé€‚ã€‚å¦‚ï¼š

   - ä¸ç”¨åœ¨æ–°æ·»åŠ çš„ li ä¸Šç»‘å®š click äº‹ä»¶ã€‚
   - å½“åˆ é™¤æŸä¸ª li æ—¶ï¼Œä¸ç”¨ç§»è§£ç»‘ä¸Šé¢çš„ click äº‹ä»¶ã€‚

ç¼ºç‚¹ï¼š

1. äº‹ä»¶å§”æ‰˜åŸºäºå†’æ³¡ï¼Œå¯¹äºä¸å†’æ³¡çš„äº‹ä»¶ä¸æ”¯æŒã€‚
2. å±‚çº§è¿‡å¤šï¼Œå†’æ³¡è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šè¢«æŸå±‚é˜»æ­¢æ‰ã€‚
3. ç†è®ºä¸Šå§”æ‰˜ä¼šå¯¼è‡´æµè§ˆå™¨é¢‘ç¹è°ƒç”¨å¤„ç†å‡½æ•°ï¼Œè™½ç„¶å¾ˆå¯èƒ½ä¸éœ€è¦å¤„ç†ã€‚æ‰€ä»¥å»ºè®®å°±è¿‘å§”æ‰˜ï¼Œæ¯”å¦‚åœ¨tableä¸Šä»£ç†tdï¼Œè€Œä¸æ˜¯åœ¨documentä¸Šä»£ç†tdã€‚
4. æŠŠæ‰€æœ‰äº‹ä»¶éƒ½ç”¨ä»£ç†å°±å¯èƒ½ä¼šå‡ºç°äº‹ä»¶è¯¯åˆ¤ã€‚æ¯”å¦‚ï¼Œåœ¨ document ä¸­ä»£ç†äº†æ‰€æœ‰ button çš„ click äº‹ä»¶ï¼Œå¦å¤–çš„äººåœ¨å¼•ç”¨æ”¹ js æ—¶ï¼Œå¯èƒ½ä¸çŸ¥é“ï¼Œé€ æˆå•å‡» button è§¦å‘äº†ä¸¤ä¸ª click äº‹ä»¶ã€‚

## è‡ªå®šä¹‰äº‹ä»¶

**æ–¹æ³•ä¸€ï¼šEvent**

è‡ªå®šä¹‰äº‹ä»¶å¯ä»¥ä½¿ç”¨ Event æ„é€ å‡½æ•°åˆ›å»ºå¦‚ä¸‹ï¼š

```js
// æ³¨å†Œäº‹ä»¶
var event = new Event('build');

// Listen for the event.
elem.addEventListener('build', function (e) { ... }, false);

// Dispatch the event.
elem.dispatchEvent(event);
```

ğŸŒ°ï¼š

```html
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <button id="btn">æŒ‰é’®</button>
        <input type="text" id="inp" />

        <script>
            let btn = document.getElementById('btn')
            let inp = document.getElementById('inp')

            // æ³¨å†Œäº‹ä»¶
            let event = new Event('myEvent')
            // ç›‘å¬äº‹ä»¶
            inp.addEventListener('myEvent', function (e) {
                // e.detail == undefined
                console.log('dispatch...', e, e.detail)
            })
            btn.addEventListener('click', function () {
                // è§¦å‘äº‹ä»¶
                inp.dispatchEvent(event)
            })
        </script>
    </body>
</html>

<!-- ç‚¹å‡»æŒ‰é’®è§¦å‘inputè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ‰“å° 'dispath...' -->
```



**æ–¹æ³•äºŒï¼šCustomEvent**

è‹¥è¦æ·»åŠ è‡ªå®šä¹‰æ•°æ®çš„è¯ï¼Œå¯ä½¿ç”¨ CustomEvent åˆ›å»ºï¼Œdetail å±æ€§ç”¨äºä¼ é€’è‡ªå®šä¹‰æ•°æ®

```js
var event = new CustomEvent('build', {
    detail: '', // è‡ªå®šä¹‰æ•°æ®
    bubbles: false, // æ˜¯å¦å†’æ³¡ï¼Œtrue || falseï¼Œé»˜è®¤false
    cancelable: false // æ˜¯å¦å¯ä»¥å–æ¶ˆé»˜è®¤è¡Œä¸ºï¼Œé»˜è®¤false
});
```

ğŸŒ°ï¼š

```html
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <button id="btn">æŒ‰é’®</button>
        <div id="par">
            <input type="text" id="inp" />
        </div>

        <script>
            let par = document.getElementById('par')
            let btn = document.getElementById('btn')
            let inp = document.getElementById('inp')

            // æ³¨å†Œäº‹ä»¶
            let event = new CustomEvent('myEvent', {
                detail: { name: 'customData' },
                bubbles: false,
            })
            // ç›‘å¬äº‹ä»¶
            inp.addEventListener('myEvent', function (e) {
                // e.detail == { name: 'customData' }
                console.log('dispatch...', e, e.detail) 
            })
            btn.addEventListener('click', function () {
                // è§¦å‘äº‹ä»¶
                inp.dispatchEvent(event)
            })
            par.addEventListener('myEvent', function (e) {
                console.log('çˆ¶çº§dispatch...')
            })
        </script>
    </body>
</html>

<!-- bubbles: falseï¼Œç‚¹å‡»æŒ‰é’®è§¦å‘inputè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ‰“å° 'dispath...' -->
<!-- bubbles: trueï¼Œç‚¹å‡»æŒ‰é’®è§¦å‘inputè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ‰“å° 'dispath...'ï¼Œ'çˆ¶çº§dispatch...' -->
```



**æ–¹æ³•ä¸‰ï¼ševent.initEvent** ï¼Œã€è¿‡æ—¶çš„æ–¹å¼ã€‘

> **å·²åºŸå¼ƒ**
> è¯¥ç‰¹æ€§å·²ç»ä» Web æ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚

```js
// Create the event.
var event = document.createEvent('Event');

// Define that the event name is 'build'.
event.initEvent('build', false, false); // æ˜¯å¦å†’æ³¡, æ˜¯å¦å¯ä»¥å–æ¶ˆé»˜è®¤è¡Œä¸º

// Listen for the event.
document.addEventListener('build', function (e) {
    // e.target matches document from above
}, false);

// target can be any Element or other EventTarget.
document.dispatchEvent(event);
```

ğŸŒ°ï¼š

```html
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <button id="btn">æŒ‰é’®</button>
        <div id="par">
            <input type="text" id="inp" />
        </div>

        <script>
            let par = document.getElementById('par')
            let btn = document.getElementById('btn')
            let inp = document.getElementById('inp')

            // æ³¨å†Œäº‹ä»¶
            let event = document.createEvent('Event')
            event.initEvent('myEvent', false, false)
            // ç›‘å¬äº‹ä»¶
            inp.addEventListener('myEvent', function (e) {
                console.log(e)
            })
            btn.addEventListener('click', function () {
                // è§¦å‘äº‹ä»¶
                inp.dispatchEvent(event)
            })
            par.addEventListener('myEvent', function (e) {
                console.log('çˆ¶çº§')
            })
        </script>
    </body>
</html>

<!-- æ•ˆæœå’ŒCustomEventç±»ä¼¼ -->
```

